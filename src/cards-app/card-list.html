<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<Link rel="import" href="./card-item.html"></Link>
<Link rel="import" href="./card-detail.html"></Link>

<dom-module id="card-list">
  <template>
    <style>
      .wrapper {
        display: flex;
        align-items: stretch;
        justify-content: space-around;
      }
    </style>

    <app-location route="{{route}}"></app-location>

    <app-route
      route="{{route}}"
      pattern="/:view"
      data="{{routeData}}">
    </app-route>
    <iron-pages selected="[[routeData.view]]" attr-for-selected="name"  selected-attribute="visible">
      <div class="wrapper" name="">
        <template
          as="card"
          is="dom-repeat" 
          items="[[cardsData]]">
          <card-item 
            card="[[card]]"
            on-link-click="openDetail">
          </card-item>
        </template>
      </div>
      <card-detail name="detail" card="[[cardDetail]]"></card-detail>
    </iron-pages>

    <button on-click="cambiarRoute">home</button>
    
  </template>
  <script>
    class CardList extends Polymer.Element {
      static get is () {return 'card-list'; }
      static get properties() {
        return {
          route: {type: Object},
          routeData: {
            type: Object,
            value: ''
          },
          cardDetail: Object,
          cardsData: {
            value: () => {
              return [
                {
                  id: 1,
                  title: 'Seguro de auto',
                  image: 'https://www.bbva.mx/content/dam/public-web/mexico/images/edufin-/persona/cards-edufin/homobre_lentes_hipster_manejando.jpg',
                  bullets: [
                    'Protege el esquipo espacial de tu coche como rines, estéreos o bocinas',
                    'Solicita asistencia las 24 hrs. desde la app BBVA S.O.S',
                    'Te prestamos un auto si el tuyo ingresa al taller mecánico',
                    'Obtienes protecció para ti y tus acompañantes',
                    'Obtienes protecció para ti y tus acompañantes',
                    'Obtienes protecció para ti y tus acompañantes',
                  ],
                  link: {
                    label: 'Más información',
                    link: 'google',
                  } 
                },
                {
                  id: 2,
                  title: 'Seguro de moto',
                  image: 'https://www.bancomer.com/content/dam/public-web/bancomer/images/edufin-/persona/cards-edufin/amigos_auto_sonriendo.jpg.img.2400.1552582133637.jpg',
                  bullets: [
                    'Protege el esquipo espacial de tu coche como rines, estéreos o bocinas',
                    'Solicita asistencia las 24 hrs. desde la app BBVA S.O.S',
                    'Te prestamos un auto si el tuyo ingresa al taller mecánico',
                    'Obtienes protecció para ti y tus acompañantes',
                  ],
                  link: {
                    label: 'Más información',
                    link: 'google',
                  } 
                },
                {
                  id: 3,
                  title: 'Seguro a terceros',
                  image: 'https://www.bancomer.com/content/dam/public-web/bancomer/images/edufin-/persona/cards-edufin/pareja_carro_atardecer.jpg.img.2400.1552582130468.jpg',
                  bullets: [
                    'Protege el esquipo espacial de tu coche como rines, estéreos o bocinas',
                    'Solicita asistencia las 24 hrs. desde la app BBVA S.O.S',
                    'Te prestamos un auto si el tuyo ingresa al taller mecánico',
                    'Obtienes protecció para ti y tus acompañantes',
                  ],
                  link: {
                    label: 'Más información',
                    link: 'google',
                  } 
                },
              ];
            }
          }
        };
      }

      static get observers() {
        return [
          '_routeChanged(route.*)',
        ]
      }

      _routeChanged(changeRecord) {
        if (changeRecord.base.path !== '/') {
          this.currentCard(changeRecord.base.path)
        }
      }

      currentCard(path) {
        let id = path.replace(/\D/g,'');
        let currenCard = this.cardsData.find(card => card.id === Number(id))
        this.set('cardDetail', currenCard)
      }

      openDetail (e) {
        this.set('cardDetail', e.detail)
      }
      
      cambiarRoute () {
        this.set('route.path', '/');
      }
    }

    window.customElements.define(CardList.is, CardList)
  </script>
</dom-module>
